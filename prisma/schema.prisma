// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url = env("POSTGRES_PRISMA_URL") // uses connection pooling
  directUrl = env("POSTGRES_URL_NON_POOLING") // uses a direct connection
}

model ubicacion {
  id            String  @id @default(uuid())
  calle         String
  numero        String
  codigo_postal String
  ciudad        String
  provincia     String
  usuario       usuario[] // Solo relación con Usuario
}

model secretaria {
  id        String    @id @default(uuid())
  usuario   usuario  @relation(fields: [usuario_id], references: [id])
  usuario_id String  @unique
}

model medico {
  id              String    @id @default(uuid())
  usuario         usuario  @relation(fields: [usuario_id], references: [id])
  usuario_id      String   @unique
  tipo_matricula  tipoMatriculaEnum 
  numero_matricula String  @unique
  especialidad    especialidad @relation(fields: [especialidad_id], references: [id]) // Relación con Especialidad
  especialidad_id String
  descripcion     String?
}

model paciente {
  id                 String    @id @default(uuid())
  usuario            usuario  @relation(fields: [usuario_id], references: [id])
  usuario_id         String   @unique
  fecha_nacimiento   DateTime
  lugar_nacimiento   String
  contacto_emergencia String
  obra_social        obraSocial @relation(fields: [obra_social_id], references: [id])
  obra_social_id     String
  fichaMedica        fichaMedica[]
}

model usuario {
  id            String     @id @default(uuid())
  tipo_documento TipoDocumentoEnum
  numero_documento String @unique
  nombre         String
  apellido       String
  correo_electronico String
  numero_telefono String
  ubicacion      ubicacion  @relation(fields: [ubicacion_id], references: [id])
  ubicacion_id   String
  contrasena     String
  secretaria     secretaria?
  medico         medico?
  paciente       paciente?
  usuarioRol   usuarioRol[]
}

enum TipoDocumentoEnum {
  Cedula_de_identidad
  DNI
  Libreta_civica
  Libreta_de_enrolamiento
  Pasaporte
}

model rol {
  id     String    @id @default(uuid())
  nombre String   @unique
  usuarioRol usuarioRol[]
}

model usuarioRol {
  usuario   usuario  @relation(fields: [usuario_id], references: [id])
  usuario_id String
  rol       rol    @relation(fields: [rol_id], references: [id])
  rol_id    String

  @@id([usuario_id, rol_id])
}

model fichaMedica {
  id                  String    @id @default(uuid())
  paciente            paciente @relation(fields: [paciente_id], references: [id])
  paciente_id         String
  alergias            String?
  diagnostico         String?
  tratamientos        String?
  medicamentos_recetados String?
}

enum tipoMatriculaEnum {
  nacional
  provincial
}

model especialidad {
  id     String    @id @default(uuid())
  nombre String   @unique
  medico medico[]
}

model obraSocial {
  id     String    @id @default(uuid())
  nombre String   @unique
  paciente paciente[]
}
