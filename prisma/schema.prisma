// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url = env("POSTGRES_PRISMA_URL") // uses connection pooling
  directUrl = env("POSTGRES_URL_NON_POOLING") // uses a direct connection
}

model Ubicacion {
  id            String  @id @default(uuid())
  calle         String
  numero        String
  codigo_postal String
  ciudad        String
  provincia     String
  Usuario       Usuario[] // Solo relación con Usuario
}

model Secretaria {
  id        String    @id @default(uuid())
  usuario   Usuario  @relation(fields: [usuario_id], references: [id])
  usuario_id String  @unique
  // Ya no tiene relación directa con Ubicacion, obtiene la ubicación a través de Usuario
}

model Medico {
  id              String    @id @default(uuid())
  usuario         Usuario  @relation(fields: [usuario_id], references: [id])
  usuario_id      String   @unique
  tipo_matricula  TipoMatriculaEnum @unique
  numero_matricula String  @unique
  especialidad    Especialidad @relation(fields: [especialidad_id], references: [id]) // Relación con Especialidad
  especialidad_id String
  descripcion     String?
  // Ya no tiene relación directa con Ubicacion, obtiene la ubicación a través de Usuario
}

model Paciente {
  id                 String    @id @default(uuid())
  usuario            Usuario  @relation(fields: [usuario_id], references: [id])
  usuario_id         String   @unique
  fecha_nacimiento   DateTime
  lugar_nacimiento   String
  contacto_emergencia String
  obra_social        ObraSocial @relation(fields: [obra_social_id], references: [id]) // Relación con ObraSocial
  obra_social_id     String
  FichaMedica        FichaMedica[]
  // Ya no tiene relación directa con Ubicacion, obtiene la ubicación a través de Usuario
}

model Usuario {
  id            String     @id @default(uuid())
  tipo_documento TipoDocumentoEnum
  numero_documento String @unique
  nombre         String
  apellido       String
  correo_electronico String
  numero_telefono String
  ubicacion      Ubicacion  @relation(fields: [ubicacion_id], references: [id])
  ubicacion_id   String
  contrasena     String
  Secretaria     Secretaria?
  Medico         Medico?
  Paciente       Paciente?
  UsuarioRoles   UsuarioRoles[]
}

enum TipoDocumentoEnum {
  Cedula_de_identidad
  DNI
  Libreta_civica
  Libreta_de_enrolamiento
  Pasaporte
}

model Roles {
  id     String    @id @default(uuid())
  nombre String   @unique
  UsuarioRoles UsuarioRoles[]
}

model UsuarioRoles {
  usuario   Usuario  @relation(fields: [usuario_id], references: [id])
  usuario_id String
  rol       Roles    @relation(fields: [rol_id], references: [id])
  rol_id    String

  @@id([usuario_id, rol_id])
}

model FichaMedica {
  id                  String    @id @default(uuid())
  paciente            Paciente @relation(fields: [paciente_id], references: [id])
  paciente_id         String
  alergias            String?
  diagnostico         String?
  tratamientos        String?
  medicamentos_recetados String?
}

enum TipoMatriculaEnum {
  nacional
  provincial
}

model Especialidad {
  id     String    @id @default(uuid())
  nombre String   @unique
  Medico Medico[]
}

model ObraSocial {
  id     String    @id @default(uuid())
  nombre String   @unique
  Paciente Paciente[]
}
